<!DOCTYPE html>
<html>
<head> <link rel="stylesheet" href="styles.css"> </head>

<body>

	<button id='settings'>
		<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg>
	</button>

	<div id = 'settingsModal'>
		<div class = 'modalContent'>

			<div id = 'close'>
				<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
			</div>

			<p>Select a region</p>

			<select id="Regions">

				<option value="Standard">Standard</option>
				<option value="Reef">Reef</option>
				<option value="Ocean">Ocean</option>
				<option value="Forest">Forest</option>
				<option value="Tundra">Tundra</option>
				<option value="Desert">Desert</option>
				<option value="Sky">Sky</option>

			</select>
		</div>
	</div>

	<div id='layout'>
		<div id='board'></div>
		<div id='sidebar'>
			<div>1</div>
			<div>2</div>
			<div>3</div>
			<div>4</div>
			<div>5</div>
			<div>6</div>
			<div>7</div>
			<div>8</div>
		</div>

		<div id='bottombar'>
			<div>a</div>
			<div>b</div>
			<div>c</div>
			<div>d</div>
			<div>e</div>
			<div>f</div>
			<div>g</div>
			<div>h</div>
		</div>

		<div id='infoBox'>
			<div id='environmentFacts'> </div>
			<div id='movesBox'> </div>
		</div>

		<div class='capturedPieces'></div>

	</div>

	<script src="class.js"> </script>
	<script src="facts.js"> </script>
	<script>

	var pieces = {};
	var pieceInfo;
	var cellCoord;
	var turn = 0;
	var moveList = [];
	var capturedPieces = [];

	document.addEventListener('keypress', e => {
		if (e.key == 'q') {
			let selectedCell = document.querySelector(".selected")

			if (selectedCell) {
				selectedCell.className = selectedCell.className.replace(' selected', '')
			}
			pieceInfo = null;
		}
	})

	let board = document.getElementById('board'); // We are getting the board into the JS
	var width = 8, height = 8;
	var columns = ["a", "b", "c", "d", "e", "f", "g", "h"];
	var rows = ["8", "7", "6", "5", "4", "3", "2", "1"];

	for (row = 0; row < height; row++) {
		for (col = 0; col < width; col++) {
			var cell = document.createElement('div');
			cell.addEventListener('click', e => {
				cellCoord = e.target.id; // get cellCoord
				if (cellCoord) { // clicked on a tile w/o piece
					if (pieceInfo) { // clicked on a piece before
						let rowPrevious = rows.indexOf(pieceInfo[1][1]); // we get the row of prev pos
						let colPrevious = columns.indexOf(pieceInfo[1][0]); // we get col of prev pos

						// we move the piece
						if(virtualBoard[rowPrevious][colPrevious] !== '') { // checks if piece is actually there
							virtualBoard[rowPrevious][colPrevious].move();
						}
					}
				} else if (turn % 2 == 0 && e.target.className.split(" ")[0][0] == "w" || turn % 2 == 1 && e.target.className.split(" ")[0][0] == "b"){ // clicked on a piece
					// clear old selected pieces
					let selectedCell = document.querySelector(".selected") // gets the cell that is selected

					if (selectedCell) {
						selectedCell.className = selectedCell.className.replace(' selected', '') // get rid of selected tag
					}

					pieceInfo = e.target.className.split(" ");
					document.getElementById(pieceInfo[1]).className += " selected"
				} else if (turn % 2 == 0 && e.target.className.split(" ")[0][0] == "b" || turn % 2 == 1 && e.target.className.split(" ")[0][0] == "w") {
					if (pieceInfo) {
						cellCoord = e.target.className.split(" ")[1];

						let rowPrevious = rows.indexOf(pieceInfo[1][1]);
						let colPrevious = columns.indexOf(pieceInfo[1][0]);
						if(virtualBoard[rowPrevious][colPrevious] != '') {
							virtualBoard[rowPrevious][colPrevious].eat();
						}
					}
				}
			});

			board.appendChild(cell);
			if ((row + col) % 2 == 0) { // white
				cell.className = `cell white${localStorage.getItem("chosenRegion")}`;
			}

			else { // black
				cell.className = `cell black${localStorage.getItem("chosenRegion")}`;
			}

			var bgFileName = "'images/"+`${localStorage.getItem("chosenRegion")}` + ".png'"
			document.body.style.backgroundImage = "url(" + bgFileName + ")";
			cell.id = columns[col] + rows[row];
		}
	}

	var virtualBoard;

	let state = "checked castle"

	if (state == "main") {
		virtualBoard = [
			[new Rook('b'),new Knight('b'),new Bishop('b'),new Queen('b'),new King('b'),new Bishop('b'),new Knight('b'),new Rook('b')],
			[new Pawn('b'),new Pawn('b'),new Pawn('b'),new Pawn('b'),new Pawn('b'),new Pawn('b'),new Pawn('b'),new Pawn('b')],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			[new Pawn('w'),new Pawn('w'),new Pawn('w'),new Pawn('w'),new Pawn('w'),new Pawn('w'),new Pawn('w'),new Pawn('w')],
			[new Rook('w'),new Knight('w'),new Bishop('w'),new Queen('w'),new King('w'),new Bishop('w'),new Knight('w'),new Rook('w')]
		];
	}

	if (state == "promotion white") {
		virtualBoard =
		[
			[new King('b'),'','','','','','',''],
			['','','','','','',new Pawn('w'),''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',new King('w')]
		];
	}

	if (state == "promotion black") {
		virtualBoard =
		[
			[new King('b'),'','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','',new Pawn('b'),'','','','',''],
			['','','','','','','',new King('w')]
		];
	}

	if (state == "checkmate white") {
		virtualBoard =
		[
			["", new Rook('b'), "", new King('b'), "", "", "", ""],
			[new Pawn('b'), new Pawn('b'), new Pawn('b'), "", "", new Queen('w'), "", ""],
			["", "", "", "", "", new Pawn('b'), "", ""],
			[new Queen('b'), "", "", new Bishop('w'), new Knight('w'), "", "", ""],
			["", "", "", new Pawn('w'), "", new Pawn('b'), "", ""],
			["", "", new Knight('w'), "", new Pawn('w'), "", "", ""],
			[new Pawn('w'), "", "", "", "", new Pawn('w'), new Pawn('w'), new Pawn('w')],
			["", "", new Rook('w'), "", "", new Rook('w'), new King('w'), ""]
		]
	}

	if (state == "false checkmate 1") {
		virtualBoard =
		[
			['','','',new Queen('b'),new King('b'),'','',''],
			['','','','','','','',new Queen('w')],
			['','','','','','','',''],
			['','','','',new Rook('w'),'','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',new King('w')]
		]
	}

	if (state == "false checkmate 2") {
		virtualBoard =
		[
			[new King('b'),new Rook('b'),'','','','','',''],
			[new Rook('b'),'','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['',new Bishop('w'),'','','','','',new King('w')]
		]
	}

	if (state == "pin") {
		virtualBoard =
		[
			['','','','',new King('w'),'','',''],
			['','','','',new Bishop('w'),'','',''],
			['','','','','','','',''],
			['','','','',new Rook('b'),'','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',new King('b')]
		]
	}

	if (state == "rook checkmate testing 1") {
		virtualBoard =
		[
			['',new Knight('b'),'',new Bishop('b'),new King('b'),new Pawn('b'),'',''],
			['','','','',new Pawn('b'),new Pawn('b'),'',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','',new Bishop('w'),'','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',new King('w')]
		]
	}

	if (state == "checked castle") {
		virtualBoard = [
			[new King('b'),'','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','',new King('w'),'','',new Rook('w')]
		];
	}

	// empty board - copy and paste as needed

	if (state == "AAAAAAAA") {
		virtualBoard = [
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','',''],
			['','','','','','','','']
		];
	}



	for (let i = 0; i < 8; i++) {
		for (let j = 0; j < 8; j++) {
			if (virtualBoard[i][j]) {
				virtualBoard[i][j].setCoord(`${columns[j]}${rows[i]}`)
				if(!(virtualBoard[i][j].pieceName in pieces)) {
					pieces[virtualBoard[i][j].pieceName] = [];
				}
				pieces[virtualBoard[i][j].pieceName].push(virtualBoard[i][j]);

				p = document.createElement('div'); // creates a piece
				p.className = `${virtualBoard[i][j].pieceName} ${columns[j] + rows[i]}`; // p.className = 'br a8'
				document.getElementById(columns[j] + rows[i]).appendChild(p);
			}
		}
	}

	function convertRowsToIndex(row) { return rows.indexOf(row) }
	function convertColsToIndex(col) { return columns.indexOf(col) }
	function convertIndexToRows(index) { return rows[index] }
	function convertIndexToCols(index) { return columns[index] }

	var modal = document.getElementById("settingsModal");

	document.getElementById("settings").addEventListener("click",e => {
		modal.style.display = "block";
		document.querySelector("#Regions").value = localStorage.getItem("chosenRegion");
	})
	document.getElementById("close").addEventListener("click", e => {
		modal.style.display = "none";
	})
	document.getElementsByTagName("body")[0].addEventListener("click", e => {
		if(e.target == modal) {
			modal.style.display = "none";
		}
	})
	document.getElementById("Regions").addEventListener("change", e => {

		console.log("selection is: " + e.target.value);
		localStorage.setItem('chosenRegion', e.target.value);

		var cells = Array.prototype.slice.call(document.getElementById("board").getElementsByClassName("cell"));
		cells.forEach(c => {
			if(c.className.includes("white")) {
				c.className = `cell white${localStorage.getItem("chosenRegion")}`;
			} else {
				c.className = `cell black${localStorage.getItem("chosenRegion")}`;
			}
		})
		var bgFileName = "'images/"+`${localStorage.getItem("chosenRegion")}` + ".png'"
		document.body.style.backgroundImage = "url(" + bgFileName + ")";

		var infoBox = document.getElementById("infoBox");
		var chosenRegion = `${localStorage.getItem("chosenRegion")}`;

		infoBox.className = `black${localStorage.getItem("chosenRegion")}`;
		environmentFacts.innerText = factsList[chosenRegion][Math.floor(Math.random()*factsList[chosenRegion].length)];

		setInterval(function() {environmentFacts.innerText = factsList[chosenRegion][Math.floor(Math.random()*factsList[chosenRegion].length)]}, 5000);

	})

	</script>
</body>
</html>
